<!--
Autores: Axel Castañeda Sánchez y Luis Roberto Rodríguez Marroquin
Descripción: Plantilla para el panel administrativo.
-->

<!DOCTYPE html>
<html>

<head>
    <title>Panel Administrativo</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        .admin-container {
            max-width: 95%;
            margin: 20px auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stat-title {
            color: #eb2525;
            font-size: 1.2em;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .stat-content {
            max-height: 400px;
            overflow-y: auto;
        }

        .stat-table {
            width: 100%;
            border-collapse: collapse;
        }

        .stat-table th,
        .stat-table td {
            padding: 8px;
            border-bottom: 1px solid #eee;
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            color: #eb2525;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
        }

        .evaluation-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .evaluation-table th {
            background: #eb2525;
            color: white;
            padding: 10px;
            text-align: center;
        }

        .evaluation-table td {
            padding: 8px;
            border: 1px solid #ddd;
            text-align: center;
        }

        .status-asignacion {
            color: #2ecc71;
            font-weight: bold;
        }

        .status-valoracion {
            color: #f1c40f;
            font-weight: bold;
        }

        .status-sin-asignacion {
            color: #e74c3c;
            font-weight: bold;
        }

        .promedio-cell {
            font-weight: bold;
        }

        .promedio-alto {
            color: #2ecc71;
        }

        .promedio-medio {
            color: #f1c40f;
        }

        .promedio-bajo {
            color: #e74c3c;
        }

        /* Nuevos estilos para la separación de secciones */
        .section-title {
            text-align: center;
            color: #eb2525;
            font-size: 1.8em;
            margin: 30px auto;
            font-weight: bold;
            text-transform: uppercase;
            background: #ffffff;
            padding: 15px 30px;
            border-radius: 8px;
            display: inline-block;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Modificar el estilo del título principal */
        .admin-container h1 {
            text-align: center;
            color: #eb2525;
            font-size: 2.2em;
            margin: 30px auto;
            font-weight: bold;
            text-transform: uppercase;
            background: #ffffff;
            padding: 15px 30px;
            border-radius: 8px;
            display: inline-block;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
            left: 50%;
            transform: translateX(-50%);
        }

        /* tarjeta más grande para listas */
        .stat-card--large {
            padding: 26px;
            min-width: 820px;
            display: flex;
            flex-direction: column;
        }

        .stat-card--large .stat-content {
            max-height: 420px;
            /* más alto para mostrar más filas antes del scroll */
            overflow-y: auto;
        }

        /* leyenda de promedios */
        .legend-list {
            list-style: none;
            padding: 0;
            margin: 0;
            font-size: 0.98rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 0;
            border-bottom: 1px dashed rgba(0, 0, 0, 0.04);
        }

        .legend-swatch {
            width: 16px;
            height: 12px;
            border-radius: 3px;
            display: inline-block;
            flex-shrink: 0;
            box-shadow: 0 1px 0 rgba(0, 0, 0, 0.06);
        }

        .legend-high {
            background: #2ecc71;
        }

        .legend-medium {
            background: #f1c40f;
        }

        .legend-low {
            background: #e74c3c;
        }

        /* pequeño ajuste para que las tablas dentro de cards grandes tengan texto legible */
        .stat-card--large .stat-table td,
        .stat-card--large .stat-table th,
        .stat-card--large .evaluation-table td,
        .stat-card--large .evaluation-table th {
            font-size: 0.98rem;
            padding: 10px;
        }
    </style>
</head>

<body>
    <div class="admin-container">
        <h1>Panel Administrativo</h1>
        {% if mail_sent == 'ok' %}
        <div style="text-align:center; margin:8px 0; color: #2ecc71; font-weight:700;">Reportes enviados correctamente.</div>
        {% elif mail_sent == 'error' %}
        <div style="text-align:center; margin:8px 0; color: #e74c3c; font-weight:700;">Error al enviar los reportes. Revisa la configuración de correo.</div>
        {% elif mail_sent == 'no_recipients' %}
        <div style="text-align:center; margin:8px 0; color: #f1c40f; font-weight:700;">No se indicó ningún destinatario.</div>
        {% endif %}

        <!-- Estadísticas Generales en Grid -->
        <div class="stats-grid">
            <!-- Campus Evaluando -->
            <div class="stat-card">
                <div class="stat-title">Campus Evaluando</div>
                <div class="stat-number">{{ stats.total_campus }}</div>
            </div>

            <!-- Total Alumnos Evaluando -->
            <div class="stat-card">
                <div class="stat-title">Total Alumnos Evaluando</div>
                <div class="stat-number">{{ stats.total_alumnos }}</div>
            </div>

            <!-- Evaluaciones por Campus -->
            <div class="stat-card">
                <div class="stat-title">Evaluaciones por Campus</div>
                <div class="stat-content">
                    <table class="stat-table">
                        <tr>
                            <th>Campus</th>
                            <th>Alumnos</th>
                        </tr>
                        {% for campus in stats.por_campus %}
                        <tr>
                            <td>{{ campus.campus }}</td>
                            <td>{{ campus.alumnos }}</td>
                        </tr>
                        {% endfor %}
                    </table>
                </div>
            </div>

            <!-- Evaluaciones por Carrera -->
            <div class="stat-card">
                <div class="stat-title">Evaluaciones por Carrera</div>
                <div class="stat-content">
                    <table class="stat-table">
                        <tr>
                            <th>Carrera</th>
                            <th>Alumnos</th>
                        </tr>
                        {% for carrera in stats.por_carrera %}
                        <tr>
                            <td>{{ carrera.carrera }}</td>
                            <td>{{ carrera.alumnos }}</td>
                        </tr>
                        {% endfor %}
                    </table>
                </div>
            </div>

            <!-- Tarjeta: Leyenda de Promedios -->
            <div class="stat-card">
                <div class="stat-title">Leyenda de Promedios</div>
                <div class="stat-content">
                    <p style="margin:0 0 10px 0; font-weight:600;">Evaluaciones Académicas</p>
                    <ul class="legend-list">
                        <li class="legend-item"><span class="legend-swatch legend-high"></span> Mayor o igual a 4.5 — Excelente / Asignación de materias
                        </li>
                        <li class="legend-item"><span class="legend-swatch legend-medium"></span> Entre 3.0 – 4.49 — En valoración
                        </li>
                        <li class="legend-item"><span class="legend-swatch legend-low"></span> &lt; Menor a 3.0 — Sin asignación / Requiere mejora
                        </li>
                    </ul>

                    <hr style="margin:12px 0; border:none; border-top:1px solid #eee;">

                    <p style="margin:0 0 10px 0; font-weight:600;">Evaluaciones de Servicios</p>
                    <ul class="legend-list">
                        <li class="legend-item"><span class="legend-swatch legend-high"></span> Mayor o igual 4.5 — Excelente</li>
                        <li class="legend-item"><span class="legend-swatch legend-medium"></span> Entre 3.5 – 4.49 — Satisfactorio</li>
                        <li class="legend-item"><span class="legend-swatch legend-low"></span> &lt; Menor a 3.5 — Requiere Atención</li>
                    </ul>
                </div>
            </div>

            <!-- Alumnos Pendientes (TARJETA AGRANDADA) -->
            <div class="stat-card stat-card--large">
                <div class="stat-title">Alumnos Pendientes de Evaluar</div>
                <div class="stat-content">
                    <table class="stat-table">
                        <tr>
                            <th>Matrícula</th>
                            <th>Nombre</th>
                            <th>Campus</th>
                            <th>Carrera</th>
                            <th>Correo</th> 
                            <th>Requeridas</th>
                            <th>Completadas</th>
                            <th>Pendientes</th>
                        </tr>
                        {% for alumno in stats.alumnos_estado %}
                        {% if alumno.pendientes and alumno.pendientes|int > 0 %}
                        <tr>
                            <td>{{ alumno.matricula }}</td>
                            <td>{{ alumno.nombre }} {{ alumno.apellidop }}</td>
                            <td>{{ alumno.campus }}</td>
                            <td>{{ alumno.carrera }}</td>
                            <td>{{ alumno.correo }}</td> 
                            <td>{{ alumno.total_requerido }}</td>
                            <td>{{ alumno.completadas }}</td>
                            <td>{{ alumno.pendientes }}</td>
                        </tr>
                        {% endif %}
                        {% endfor %}
                    </table>
                </div>
            </div>

        </div> <!-- end .stats-grid -->

        <!-- Maestros - Tarjeta en la fila de abajo -->
        <div class="stat-card" style="margin-bottom:20px;">
            <div class="stat-title">Maestros - Estado de Evaluación</div>
            <div class="stat-content">
                <table class="stat-table">
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Total Evaluaciones</th>
                        <th>Estado</th>
                    </tr>
                    {% if maestros %}
                        {% for m in maestros %}
                        <tr>
                            <td>{{ m.id_docente }}</td>
                            <td>{{ m.nombre_docente }}</td>
                            <td>{{ m.total_evaluaciones }}</td>
                            <td>{{ m.estado }}</td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr><td colspan="4">No hay datos de maestros disponibles.</td></tr>
                    {% endif %}
                </table>
            </div>
        </div>

        <!-- Sección de Evaluaciones Docentes -->
        <div class="section-title">Evaluaciones Académicas</div>
        <div class="stat-card">
            <div class="stat-title">Evaluaciones de Docentes</div>
            <div class="stat-content">
                <table class="evaluation-table">
                    <tr>
                        <th>Docente</th>
                        <th>Campus</th>
                        <th>Materia</th>
                        <th>Promedio</th>
                        <th>Estado de Asignación</th>
                    </tr>
                    {% for eval in evaluaciones %}
                    <tr>
                        <td>{{ eval.nombre_docente }} {{ eval.apellidop }} {{ eval.apellidom }}</td>
                        <td>{{ eval.campus_nombre }}</td>
                        <td>{{ eval.materia }}</td>
                        <td
                            class="promedio-cell {% if eval.promedio >= 4.5 %}promedio-alto{% elif eval.promedio >= 3.0 %}promedio-medio{% else %}promedio-bajo{% endif %}">
                            {{ eval.promedio }}
                        </td>
                        <td class="status-{{ eval.estatus_docente|lower|replace(' ', '-') }}">
                            {{ eval.estatus_docente }}
                        </td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
        </div>

        <!-- Sección de Servicios -->
        <div class="section-title">Evaluaciones de Servicios</div>
        <div class="stat-card">
            <div class="stat-title">Evaluaciones de Servicios Escolares</div>
            <div class="stat-content">
                <table class="evaluation-table">
                    <tr>
                        <th>Campus</th>
                        <th>Total Evaluaciones</th>
                        <th>Promedio</th>
                        <th>Estado de Servicios</th>
                    </tr>
                    {% for serv in servicios %}
                    <tr>
                        <td>{{ serv.campus_nombre }}</td>
                        <td>{{ serv.total_evaluaciones }}</td>
                        <td
                            class="promedio-cell {% if serv.promedio >= 4.5 %}promedio-alto{% elif serv.promedio >= 3.5 %}promedio-medio{% else %}promedio-bajo{% endif %}">
                            {{ serv.promedio }}
                        </td>
                        <td class="status-{{ serv.estatus_servicios|lower|replace(' ', '-') }}">
                            {{ serv.estatus_servicios }}
                        </td>
                    </tr>
                    {% endfor %}
                </table>
                <a href="{{ url_for('logout') }}" class="logout-link">Cerrar sesión</a>
                <!-- Formulario para enviar reportes por correo -->
                <form method="post" action="{{ url_for('enviar_reportes') }}" style="margin-top:18px; text-align:center;">
                    <label for="recipients" style="font-weight:600;">Correos (separados por comas):</label>
                    <input id="recipients" name="recipients" type="text" placeholder="correo1@dominio.com, correo2@dominio.com" style="width:58%; padding:8px; margin-left:8px;" />
                    <button type="submit" style="margin-left:8px; padding:8px 12px; background:#eb2525; color:#fff; border:none; border-radius:4px;">Enviar reportes por correo</button>
                </form>
            </div>
        </div>
    </div>
</body>

</html>